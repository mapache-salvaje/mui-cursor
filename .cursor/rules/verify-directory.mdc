---
description: Prevent installation or commands in wrong directories
globs: ["*"]
alwaysApply: true
---

# Directory Verification

<rule>
name: verify-directory
description: NEVER run ANY commands without verifying directory first
filters:
  - type: command
    pattern: "(npm|yarn|pnpm|cd|ls|rm|cp|mv)"
  - type: event
    pattern: "file_create|file_modify"

actions:
  - type: reject
    conditions:
      - pattern: "^(npm|yarn|pnpm|cd|ls|rm|cp|mv) .*$"
        message: "STOP: Directory verification required"

  - type: suggest
    message: |
      MANDATORY DIRECTORY VERIFICATION:

      1. ALWAYS verify directory BEFORE running ANY command:
         ```bash
         pwd  # MUST run this first
         ls   # MUST verify contents
         ```

      2. NEVER assume you're in the right directory from previous commands
         - Shell state can be reset
         - Directory can change
         - Previous commands may have failed

      3. REQUIRED verification steps IN ORDER:
         a. Run pwd to check current directory
         b. Verify it matches the target directory EXACTLY
         c. Run ls to confirm expected files exist
         d. ONLY THEN run your intended command

      4. If not in correct directory:
         a. Use cd with FULL relative path
         b. Verify new directory with pwd
         c. Verify contents with ls
         d. ONLY THEN proceed

      5. NEVER chain commands with && until directory is verified:
         BAD:  cd some/dir && npm install
         GOOD: cd some/dir
               pwd  # verify
               ls   # verify
               npm install

      6. ALWAYS treat directory changes as dangerous operations:
         - Directory context is critical
         - Wrong directory can break things
         - Verification is mandatory
         - No exceptions

examples:
  - input: |
      # WRONG - No verification
      npm install
      
      # WRONG - Blind directory change
      cd some/dir && npm install
      
      # CORRECT - Full verification
      pwd  # /path/to/project
      ls   # verify package.json exists
      npm install
      
      # CORRECT - Directory change with verification
      cd some/dir
      pwd  # verify new location
      ls   # verify contents
      npm install
    output: "Directory verification is MANDATORY before ANY command"

metadata:
  priority: critical
  version: 2.0
</rule>